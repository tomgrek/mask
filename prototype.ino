#include <boards.h>
#include <SPI.h>
#include <ble_shield.h>
#include <services.h>


#include <Adafruit_NeoPixel.h>

#define PIN 7

Adafruit_NeoPixel strip = Adafruit_NeoPixel(9, PIN, NEO_GRB + NEO_KHZ800);

void setup() {
  strip.begin();
  strip.show(); // Initialize all pixels to 'off'
  //ble_begin();
}

unsigned long endtime, currtime;
float t;
int half_t;

void flashs(int r, int g, int b, float hz, int secs)
{
  t = 1 / hz; half_t = (int)((t*1000)/2);
  endtime = millis() + (secs*1000);
  currtime = millis();
  while (currtime < endtime)
  {
    for (int i = 0; i < 9; i++)
    {
      strip.setPixelColor(i,0);
    }
    strip.show();
    delay(half_t);
    for (int i = 0; i < 9; i++)
    {
      strip.setPixelColor(i,strip.Color(r,g,b));
    }
    strip.show();
    delay(half_t);
    currtime = millis();
  }
}

 int r[180] = {255,255,255,255,255,255,255,255,255,255,255,255,255,255,252,249,246,243,151,151,151,151,151,151,151,151,151,151,143,135,128,121,115,109,103,98,93,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,12,10,9,8,7,6,5,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
int g[180] = {12,12,12,12,12,12,12,13,14,15,16,17,18,43,44,45,46,47,107,111,115,119,123,127,130,133,136,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,197,189,182,175,169,163,157,152,147,142,80,80,80,80,80,80,80,80,80,80,80,80,80,73,66,60,55,50,46,42,39,36,34,32,30,28,27,26,25,24,23,22,21,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,16,13,10,8,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
int b[180] = {12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,14,15,16,17,18,19,20,58,58,58,58,58,58,58,58,58,58,58,58,65,71,77,83,88,93,98,102,106,110,113,168,177,185,192,199,205,210,215,219,222,225,228,230,232,234,236,237,238,239,240,241,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253};
float freq[180] = {25.9,25.6,25.3,25.0,24.3,23.7,23.0,22.7,22.4,22.1,21.9,21.6,21.3,21.0,20.6,20.2,19.8,19.5,19.1,18.7,18.4,18.1,17.7,17.4,17.0,16.7,16.3,16.0,15.7,15.4,15.1,14.8,14.5,14.2,13.9,13.6,13.3,13.0,12.6,12.3,11.9,11.6,11.2,10.9,10.5,10.2,10.0,09.9,09.8,09.7,09.6,09.5,09.4,09.3,09.2,09.1,09.0,08.8,08.7,08.5,08.3,08.2,08.0,07.8,07.7,07.5,07.3,07.2,07.0,07.0,06.9,06.9,06.8,06.8,06.7,06.7,06.6,06.6,06.6,06.5,06.5,06.4,06.4,06.3,06.3,06.3,06.2,06.2,06.1,06.1,06.1,06.0,06.0,06.0,05.9,05.9,05.9,05.9,05.8,05.8,05.8,05.8,05.7,05.7,05.7,05.6,05.6,05.6,05.6,05.5,05.5,05.5,05.5,05.4,05.4,05.4,05.3,05.3,05.3,05.3,05.2,05.2,05.2,05.2,05.1,05.1,05.1,05.1,05.0,05.0,05.0,05.0,05.0,04.9,04.9,04.9,04.9,04.9,04.9,04.8,04.8,04.8,04.8,04.8,04.8,04.7,04.7,04.7,04.7,04.7,04.7,04.6,04.6,04.6,04.6,04.6,04.6,04.5,04.5,04.5,04.5,04.5,04.4,04.4,04.4,04.4,04.3,04.3,04.3,04.3,04.3,04.2,04.2,04.2,04.2,04.2,04.1,04.1,04.1,04.1};
void loop() {
//ble_do_events();
    for (int i = 0; i <180; i++)
  {
    //freq = max(4,12-((8*i)/50));
    flashs(r[i],g[i],b[i],freq[i],1);
  }
  
//memset(leds,0,8*3);
    strip.show();
  delay(5000);
}
